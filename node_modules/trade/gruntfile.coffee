module.exports = (grunt) ->
  grunt.initConfig
    pkg : grunt.file.readJSON("package.json")

    requirejs :
      dist :
        options :
          baseUrl : "dist/js/app"
          name : "app"
          out : "dist/js/app/build.js"
          optimize : "none"

    coffee :
      dist :
        files : [
          expand: true
          dest : "dist/js"
          cwd : "src/cs"
          src : "**/*.coffee"
          ext : ".js"
        ]
      test :
        options :
          bare : true
        files :
          "test/js/spec.js" : ["test/cs/*-spec.coffee"]

    coffeelint :
      app : ["gruntfile.coffee","src/cs/**/*.coffee", "test/cs/*-spec.coffee"]

    uglify :
      options :
        report : "min"
        preserveComments : no
      compile :
        files : [
          expand : true
          dest : "dist/js/vendor"
          cwd : "src/vendor/js"
          src : "*.js"
          ext : ".js"
        ]
    
    copy :
      dist :
        files :[
          expand : true
          cwd : "src/img/"
          src : ["**"]
          dest : "dist/images/"
        ]

  grunt.loadNpmTasks "grunt-contrib-coffee"
  grunt.loadNpmTasks "grunt-contrib-copy"
  grunt.loadNpmTasks "grunt-coffeelint"
  grunt.loadNpmTasks "grunt-contrib-uglify"
  grunt.loadNpmTasks "grunt-contrib-requirejs"

  grunt.registerTask "default", [
    "coffeelint"
    "uglify:compile"
    "coffee:dist"
    "requirejs:dist"
    "copy:dist"
  ]

  grunt.registerTask "test", [
    "coffeelint"
    "coffee:test"
  ]
