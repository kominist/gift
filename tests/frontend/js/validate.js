!function(a){"function"==typeof define&&define.amd?define(["backbone","underscore"],a):"object"==typeof exports?module.exports=a(require("backbone"),require("underscore")):a(window.Backbone,window._)}(function(a,b){"use strict";var c=a.Validator={version:"0.2.4",validate:function(a,c,d){var e={};return b.chain(a).each(function(f,g){var h=c[g],i=this._validateAll(h,g,f,d,a);i.length&&(e[g]=b.uniq(i))},this),b.size(e)?e:null},_validateAll:function(a,c,d,e,f){return e=e||this,b.inject(b.flatten([a||[]]),function(a,h){return b.chain(h).omit("message").each(function(i,j){var k=this._validators[j];if(!k)throw Error("Missed validator: "+j);var l=k.fn.apply(e,[d,i,f]);if(l!==!0){var m=h.message||l||g(c,d,i,j,e)||k.message||"Invalid";b.isFunction(m)&&(m=m.apply(e,[c,d,i,j])),a.push(m)}},this),a},[],this)},add:function(a,b,c){this._validators[a]={fn:b,message:c}},_validators:{}};c.Extensions={View:{bindValidation:function(a,d){if(a=a||this.model,!a)throw"Model is not provided";this.listenTo(a,"validated",function(a,e,f){var g=b.extend({},c.ViewCallbacks,b.pick(this,"onInvalidField","onValidField"),d);f=f||{},b.each(e,function(b,c){var d=f[c];d&&d.length?g.onInvalidField.call(this,c,b,d,a):g.onValidField.call(this,c,b,a)},this)})}},Model:{validate:function(a,d){var f=b.result(this,"validation")||{},g=e(this,a),h=c.validate(g,f,this);return d=d||{},d.silent||b.defer(b.bind(this.triggerValidated,this),g,h),d&&d.suppress?null:h},_validate:function(a,c){if(!c.validate||!this.validate)return!0;var d=e(this,a),f=this.validationError=this.validate(d,c)||null;return f&&this.trigger("invalid",this,f,b.extend(c||{},{validationError:f})),!f},triggerValidated:function(a,b){var c=e(this,a),d=f(b);this.validationError=d,this.trigger("validated",this,c,d),this.trigger("validated:"+(d?"invalid":"valid"),this,c,d)},isValid:function(a,b){var c=e(this,a);return!this.validate||!this.validate(c,b)}}};var d=function(a,c){return b.inject(b.flatten([c]),function(b,c){return b[c]=a[c],b},{})},e=function(a,c){var e,f,g=a.attributes,h=b.result(a,"validation");return b.isArray(c)||b.isString(c)?e=d(g,c):c?e=c:(f=b.extend({},g,h||{}),e=d(g,b.keys(f))),e},f=function(a){var c=b.inject(a,function(a,b,c){return b.length&&(a[c]=b),a},{});return b.size(c)?c:null},g=function(){return c.createMessage?c.createMessage.apply(null,arguments):!1};c.ViewCallbacks={onValidField:function(a){var b=this.$('input[name="'+a+'"]');b.removeClass("error"),b.next(".error-text").remove()},onInvalidField:function(a,b,c){var d=this.$('input[name="'+a+'"]');d.next(".error-text").remove(),d.addClass("error").after('<div class="error-text">'+c.join(", ")+"</div>")}};var h=[{name:"required",message:"Is required",fn:function(a,b){return b===!1||!!a}},{name:"blank",message:"Could not be blank",fn:function(a,c){return c===!0?!0:b.isString(a)?!a.match(/^[\s\t\r\n]*$/):b.isArray(a)?!!a.length:b.isObject(a)?!b.isEmpty(a):!!a}},{name:"collection",fn:function(a,c){if(c===!1)return!0;var d=b.inject(a.models||a,function(a,b,c){var d=b.validate();return d&&a.push([c,d]),a},[]);return d.length?d:!0}},{name:"minLength",message:"Is too short",fn:function(a,b){return!a||a.length>=b}},{name:"maxLength",message:"Is too long",fn:function(a,b){return!a||b>=a.length}},{name:"format",message:"Does not match format",fn:function(a,b){return!a||!!(""+a).match(c.formats[b]||b)}},{name:"fn",fn:function(a,b,c){return b.call(this,a,c)}}];return c.formats={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},b.each(h,function(a){c.add(a.name,a.fn,a.message)}),b.extend(a.Model.prototype,c.Extensions.Model),b.extend(a.View.prototype,c.Extensions.View),c});